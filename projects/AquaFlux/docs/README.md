# AquaFlux é¡¹ç›®æ–‡æ¡£ä¸­å¿ƒ

> **ç»“æ„åŒ–RWAä¸‰ä»£å¸åè®®** â€” å°†RWAåˆ†æ‹†ä¸ºå¯ç»„åˆçš„DeFiäº§å“  
> ETHShanghai 2025 Hackathon

---

## ğŸš€ å¿«é€Ÿå…¥å£

<table>
<tr>
<td width="50%">

### ğŸ“˜ æ–°æ‰‹å…¥é—¨
- **[å¿«é€Ÿå¼€å§‹ â†’](../deployments/QUICK_START.md)**  
  5åˆ†é’Ÿéƒ¨ç½²å¹¶ä½“éªŒå®Œæ•´æµç¨‹
  
- **[å¸¸è§é—®é¢˜ â†’](./FAQ.md)**  
  25+ä¸ªé«˜é¢‘é—®é¢˜è§£ç­”

</td>
<td width="50%">

### ğŸ—ï¸ æ·±å…¥äº†è§£
- **[æŠ€æœ¯æ¶æ„ â†’](./ARCHITECTURE.md)**  
  æ·±åº¦è§£æåˆçº¦è®¾è®¡ä¸æ•°æ®æµ
  
- **[é¡¹ç›®æ¦‚è§ˆ â†’](../README.md)**  
  è¿”å›é¡¹ç›®ä¸»é¡µ

</td>
</tr>
</table>

---

## ğŸ“– æ–‡æ¡£å¯¼èˆª

### ğŸ¯ å¿«é€Ÿäº†è§£

- **é¡¹ç›®æ¦‚è¿°**: è¯·é˜…è¯» [æ ¹ç›®å½• README](../README.md)
- **æ ¸å¿ƒæ¦‚å¿µ**: P/C/S ä¸‰ä»£å¸æ¨¡å‹ â€” å°†ä¸€ä»½RWAåº•å±‚èµ„äº§é€šè¿‡é‡‘èå·¥ç¨‹æ‹†åˆ†ä¸ºæœ¬é‡‘ï¼ˆPrincipalï¼‰ã€ç¥¨æ¯ï¼ˆCouponï¼‰ã€é¦–æŸä¿æŠ¤ï¼ˆShieldï¼‰ä¸‰ä¸ªç‹¬ç«‹äº¤æ˜“çš„ä»£å¸
- **æŠ€æœ¯äº®ç‚¹**: 
  - âœ… æ—¶é—´é”æ²»ç† + è§’è‰²æƒé™ç®¡ç†
  - âœ… å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆæ³¨å†Œâ†’éªŒè¯â†’åŒ…è£¹â†’åˆ†æ‹†â†’åˆ°æœŸåˆ†é…ï¼‰
  - âœ… å†…ç½®è´¹ç”¨è®¡æä¸æ”¶ç›Šåˆ†é…æœºåˆ¶
  - âœ… å‰åç«¯å®Œæ•´é›†æˆ

---

## ğŸ—ï¸ æŠ€æœ¯æ–‡æ¡£

### 1ï¸âƒ£ æ™ºèƒ½åˆçº¦ (Contracts)

**ğŸ“‚ è·¯å¾„**: [`../contracts/`](../contracts/)  
**ğŸ“„ è¯¦ç»†æ–‡æ¡£**: [Contracts README](../contracts/README.md)

**æ ¸å¿ƒå†…å®¹**:
- âœ… `AquaFluxCore.sol` - æ ¸å¿ƒåè®®é€»è¾‘ (UUPSå¯å‡çº§)
- âœ… `TokenFactory.sol` - EIP-1167ä»£ç†å·¥å‚ï¼Œæ‰¹é‡éƒ¨ç½²P/C/Sä»£å¸
- âœ… `AqToken/PToken/CToken/SToken` - å››ç±»ERC-20ä»£å¸å®ç°
- âœ… `AquaFluxTimelock.sol` - æ—¶é—´é”æ²»ç†
- âœ… å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€æœºä¸å®‰å…¨çº¦æŸ

**å¿«é€Ÿå‘½ä»¤**:
```bash
cd contracts
pnpm install
pnpm compile
pnpm test                    # è¿è¡Œæµ‹è¯•å¥—ä»¶
pnpm hardhat run scripts/deploy/deploy-all.ts --network sepolia
```

**å…³é”®ç‰¹æ€§**:
- ğŸ” å¤šè§’è‰²æƒé™æ§åˆ¶ (Admin/Timelock/Verifier/Operator)
- ğŸ’° çµæ´»çš„è´¹ç”¨è®¡ææœºåˆ¶ (wrap/split/merge/unwrap)
- ğŸ“Š åˆ°æœŸåˆ†é…ä¸æ”¶ç›Šé¢†å–
- â±ï¸ äº¤æ˜“æˆªæ­¢æ—¥æœŸä¸æ“ä½œçª—å£ç®¡ç†

---

### 2ï¸âƒ£ åç«¯æœåŠ¡ (Backend)

**ğŸ“‚ è·¯å¾„**: [`../backend/`](../backend/)  
**ğŸ“„ è¯¦ç»†æ–‡æ¡£**: [Backend README](../backend/README.md)

**æŠ€æœ¯æ ˆ**:
- Express + TypeScript
- Prisma ORM + PostgreSQL
- JWT è®¤è¯ + Redis ç¼“å­˜
- ä¾èµ–æ³¨å…¥ (TSyringe)

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ“¡ èµ„äº§ç®¡ç† API (åˆ—è¡¨ã€è¯¦æƒ…ã€ç­›é€‰)
- ğŸ”„ ç»“æ„åŒ–æ“ä½œæ¥å£ (split/mergeç›‘å¬)
- ğŸ“Š æŠ•èµ„ç»„åˆæ•°æ®èšåˆ
- ğŸ” ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†

---

### 3ï¸âƒ£ å‰ç«¯åº”ç”¨ (Frontend)

**ğŸ“‚ è·¯å¾„**: [`../frontend/`](../frontend/)  
**ğŸ“„ æ–‡æ¡£**: æŸ¥çœ‹ `frontend/` ç›®å½•ä¸‹çš„README

**æŠ€æœ¯æ ˆ**:
- React + Vite
- Wagmi + Viem (Web3äº¤äº’)
- TailwindCSS (æ ·å¼)
- Recharts (å›¾è¡¨å¯è§†åŒ–)

**æ ¸å¿ƒé¡µé¢**:
- ğŸ  **Markets**: æµè§ˆæ‰€æœ‰RWAèµ„äº§åŠP/C/Sä»£å¸å¸‚åœº
- ğŸ’¼ **Portfolio**: ç”¨æˆ·æŒä»“ä¸æ”¶ç›Šè·Ÿè¸ª
- ğŸ”€ **Swap**: DEXäº¤æ˜“ç•Œé¢ (Uniswap V3é›†æˆ)
- ğŸ—ï¸ **Structure**: Split/Mergeæ“ä½œç•Œé¢

**å¿«é€Ÿå¯åŠ¨**:
```bash
cd frontend
npm install
npm run dev                   # å¼€å‘æ¨¡å¼ (localhost:5173)
npm run build                 # ç”Ÿäº§æ„å»º
```

---

## ğŸš€ å®Œæ•´éƒ¨ç½²æµç¨‹

### Step 1: éƒ¨ç½²æ™ºèƒ½åˆçº¦
```bash
cd contracts
pnpm hardhat run scripts/deploy/deploy-all.ts --network sepolia
# ä¼šç”Ÿæˆ scripts/deploy/addresses.json
```

### Step 2: å¯åŠ¨åç«¯æœåŠ¡
```bash
cd backend
cp .env.example .env          # é…ç½®ç¯å¢ƒå˜é‡
docker-compose up -d
pnpm prisma:migrate
pnpm dev
```

### Step 3: å¯åŠ¨å‰ç«¯
```bash
cd frontend
# æ›´æ–° src/constants/addresses.ts (ä½¿ç”¨Step 1çš„åˆçº¦åœ°å€)
npm run dev
```

### Step 4: æ¼”ç¤ºæµç¨‹
1. **æ³¨å†Œèµ„äº§**: è°ƒç”¨ `AquaFluxCore.register()`
2. **éªŒè¯èµ„äº§**: ç”± Verifier è§’è‰²è°ƒç”¨ `verify()`
3. **åŒ…è£¹èµ„äº§**: ç”¨æˆ·è°ƒç”¨ `wrap()` å°†åº•å±‚èµ„äº§æ¢ä¸ºAqToken
4. **åˆ†æ‹†ä»£å¸**: è°ƒç”¨ `split()` å°†AqTokenåˆ†æ‹†ä¸ºP/C/S (1:1:1)
5. **äº¤æ˜“/è½¬è®©**: P/C/Sä»£å¸å¯åœ¨DEXè‡ªç”±äº¤æ˜“
6. **åˆå¹¶ä»£å¸**: è°ƒç”¨ `merge()` å°†P/C/Såˆå¹¶å›AqToken
7. **è§£åŒ…èµ„äº§**: è°ƒç”¨ `unwrap()` èµå›åº•å±‚èµ„äº§
8. **åˆ°æœŸæµç¨‹**: 
   - `withdrawForRedemption()` - æå–åº•å±‚èµ„äº§è¿›è¡Œçº¿ä¸‹å…‘ä»˜
   - `setDistributionConfig()` - é…ç½®åˆ†é…ä»£å¸ä¸èµ„é‡‘æ± 
   - `setDistributionPlan()` - è®¾å®šP/C/Såˆ†é…æ¯”ä¾‹
   - `claimMaturityReward()` - ç”¨æˆ·é¢†å–åˆ°æœŸæ”¶ç›Š

---

## ğŸ“Š æ¶æ„å›¾

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend dApp                        â”‚
â”‚  (React + Wagmi + Viem)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Markets  â”‚ â”‚Portfolio â”‚ â”‚   Swap   â”‚ â”‚Structure â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Backend API      â”‚    â”‚  Smart Contracts   â”‚
         â”‚   (Express + TS)   â”‚    â”‚   (Solidity)       â”‚
         â”‚                    â”‚    â”‚                    â”‚
         â”‚ â€¢ Asset APIs       â”‚    â”‚ â€¢ AquaFluxCore    â”‚
         â”‚ â€¢ Market Data      â”‚    â”‚ â€¢ TokenFactory     â”‚
         â”‚ â€¢ Portfolio        â”‚    â”‚ â€¢ P/C/S Tokens    â”‚
         â”‚ â€¢ Authentication   â”‚    â”‚ â€¢ Timelock Gov    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    PostgreSQL      â”‚    â”‚    Blockchain      â”‚
         â”‚  (Prisma ORM)     â”‚    â”‚  (Sepolia/Mainnet) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»£å¸æµè½¬å›¾

```
Underlying Asset (USDC/USDT/RWA)
         â”‚
         â”‚ wrap()
         â–¼
    AqToken (Wrapped)
         â”‚
         â”‚ split()
         â–¼
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚         â”‚
 P-Token   C-Token   S-Token
 (æœ¬é‡‘)    (ç¥¨æ¯)   (é¦–æŸä¿æŠ¤)
    â”‚         â”‚         â”‚
    â”‚   å¯åœ¨DEX/AMMäº¤æ˜“  â”‚
    â”‚         â”‚         â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚ merge()
         â–¼
    AqToken (Wrapped)
         â”‚
         â”‚ unwrap()
         â–¼
Underlying Asset (Redeemed)
```

---

## ğŸ” å®‰å…¨æ€§

- âœ… **é‡å…¥ä¿æŠ¤**: ä½¿ç”¨ `ReentrancyGuard`
- âœ… **æƒé™æ§åˆ¶**: `AccessControl` å¤šè§’è‰²ç®¡ç†
- âœ… **å®‰å…¨è½¬è´¦**: `SafeERC20` åŒ…è£…
- âœ… **æš‚åœæœºåˆ¶**: å…¨å±€/å•èµ„äº§çº§åˆ«çš„ç´§æ€¥æš‚åœ
- âœ… **å‡çº§æ²»ç†**: UUPSå¯å‡çº§ + Timelockæ—¶é—´é”
- âœ… **è¾“å…¥éªŒè¯**: ä¸¥æ ¼çš„å‚æ•°æ ¡éªŒä¸è¾¹ç•Œæ£€æŸ¥
- âœ… **è´¹ç”¨ä¸Šé™**: æ‰€æœ‰è´¹ç‡é™åˆ¶åœ¨ â‰¤100% (10000 bps)

**âš ï¸ é»‘å®¢æ¾å…è´£å£°æ˜**: 
- æœ¬é¡¹ç›®ä¸ºæ¦‚å¿µéªŒè¯ï¼Œæœªç»å®¡è®¡
- ä»…ç”¨äºæµ‹è¯•ç½‘ç¯å¢ƒ
- ä¸æ„æˆæŠ•èµ„å»ºè®®

---

## ğŸ§ª æµ‹è¯•

### åˆçº¦æµ‹è¯•
```bash
cd contracts
pnpm test                      # è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test test/basic.test.js   # è¿è¡Œå•ä¸ªæµ‹è¯•
pnpm coverage                  # æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
```

**æµ‹è¯•è¦†ç›–**:
- âœ… Split/Mergeä¸å˜å¼éªŒè¯
- âœ… å®Œæ•´ç”Ÿå‘½å‘¨æœŸæµç¨‹æµ‹è¯•
- âœ… æ—¶é—´é”æ²»ç†æµ‹è¯•
- âœ… æƒé™æ§åˆ¶æµ‹è¯•
- âœ… è´¹ç”¨è®¡æä¸æå–æµ‹è¯•
- âœ… åˆ°æœŸåˆ†é…æµ‹è¯•

---

## ğŸ“¦ é¡¹ç›®ç»“æ„é€ŸæŸ¥

```
AquaFlux/
â”œâ”€â”€ contracts/           # Solidityæ™ºèƒ½åˆçº¦
â”‚   â”œâ”€â”€ core/           # æ ¸å¿ƒåè®®é€»è¾‘
â”‚   â”œâ”€â”€ token/          # P/C/Sä»£å¸å®ç°
â”‚   â”œâ”€â”€ governance/     # æ—¶é—´é”æ²»ç†
â”‚   â””â”€â”€ test/           # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ backend/            # Node.jsåç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ modules/    # ä¸šåŠ¡æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ middlewares/ # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ lib/        # å·¥å…·åº“
â”‚   â””â”€â”€ prisma/         # æ•°æ®åº“æ¨¡å‹
â”œâ”€â”€ frontend/           # Reactå‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/      # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/ # UIç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ hooks/      # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â””â”€â”€ api/        # APIæ¥å£
â”‚   â””â”€â”€ public/         # é™æ€èµ„æº
â”œâ”€â”€ docs/               # ğŸ“ ä½ åœ¨è¿™é‡Œ
â””â”€â”€ README.md           # é¡¹ç›®ä¸»README
```

---

## ğŸ¯ é»‘å®¢æ¾è¯„å®¡è¦ç‚¹

### åˆ›æ–°æ€§
- âœ… **ç‹¬åˆ›çš„ä¸‰ä»£å¸æ¨¡å‹**: å°†RWAæ‹†åˆ†ä¸ºå¯ç‹¬ç«‹äº¤æ˜“çš„é£é™©/æ”¶ç›Šå±‚çº§
- âœ… **æ—¶é—´ç»´åº¦é‡‘èäº§å“**: å¼•å…¥åˆ°æœŸæ—¥ä¸æ“ä½œçª—å£æ¦‚å¿µ
- âœ… **é¦–æŸä¿æŠ¤æœºåˆ¶**: S-TokenæŒæœ‰è€…äº«å—è´¹ç”¨æ¿€åŠ±åŒæ—¶æ‰¿æ‹…é¦–æŸ

### å®Œæ•´æ€§
- âœ… åˆçº¦å·²éƒ¨ç½²åˆ°Sepoliaæµ‹è¯•ç½‘
- âœ… å‰åç«¯å®Œæ•´é›†æˆ
- âœ… å®Œå–„çš„æƒé™ç®¡ç†ä¸æ²»ç†æœºåˆ¶
- âœ… è¯¦ç»†çš„æµ‹è¯•è¦†ç›–

### æŠ€æœ¯æ·±åº¦
- âœ… UUPSå¯å‡çº§åˆçº¦æ¨¡å¼
- âœ… EIP-1167æœ€å°ä»£ç†å·¥å‚
- âœ… å¤æ‚çš„è´¹ç”¨ä¼šè®¡ç³»ç»Ÿ
- âœ… çŠ¶æ€æœºé©±åŠ¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

### å¯ç”¨æ€§
- âœ… ç›´è§‚çš„å‰ç«¯äº¤äº’ç•Œé¢
- âœ… å®Œæ•´çš„APIæ–‡æ¡£
- âœ… æ¸…æ™°çš„éƒ¨ç½²è„šæœ¬

---

## ğŸ“ è”ç³»æ–¹å¼

- **Team**: AquaFlux
- **Email**: hi@aquaflux.pro
- **GitHub**: [é¡¹ç›®ä»“åº“é“¾æ¥]

---

## ğŸ“„ è®¸å¯è¯

MIT License Â© 2025 AquaFlux Contributors

---

**ä¸ºè¯„å®¡å‡†å¤‡çš„å¿«é€Ÿé“¾æ¥**:
- ğŸ“ [åˆçº¦è¯¦ç»†æ–‡æ¡£](../contracts/README.md)
- ğŸ”§ [åç«¯APIæ–‡æ¡£](../backend/README.md)
- ğŸ¨ [å‰ç«¯ä½¿ç”¨è¯´æ˜](../frontend/)
- ğŸš€ [éƒ¨ç½²åœ°å€](../contracts/scripts/deploy/addresses.json)

