# 信用分刷新问题排查指南

## 🔍 问题诊断步骤

### 步骤1: 检查浏览器控制台
1. 打开浏览器开发者工具 (F12)
2. 切换到 "Console" 标签
3. 连接钱包后查看日志输出

**正常日志应该显示：**
```
🔍 useCrediNet - 链ID变化: 11155111
📋 获取到的地址配置: {CrediNetCore: "0x7CE2fbEfDF5dc7E43477816bfD2e89d5b26Cff38", ...}
🎯 使用的合约地址: 0x7CE2fbEfDF5dc7E43477816bfD2e89d5b26Cff38
✅ 设置合约地址: 0x7CE2fbEfDF5dc7E43477816bfD2e89d5b26Cff38
📊 信用信息查询状态:
  - 用户地址: 0xB95E8e0960Ad789D560AD6e65D574180Af9361b8
  - 合约地址: 0x7CE2fbEfDF5dc7E43477816bfD2e89d5b26Cff38
  - 查询启用: true
  - 加载状态: false
  - 原始数据: [...]
  - 错误信息: null
```

### 步骤2: 使用调试工具
1. 访问 Web3Demo 页面
2. 查看 "调试信息" 卡片
3. 点击 "运行测试" 按钮
4. 查看测试结果

### 步骤3: 检查合约连接状态
在 Web3Demo 页面查看 "合约连接状态" 卡片，确认：
- 所有合约地址显示为 ✅
- 没有 ❌ 错误状态

## 🛠️ 常见问题及解决方案

### 问题1: 显示"加载信用数据中..."
**原因**: 合约调用正在进行中
**解决方案**: 
- 等待几秒钟
- 检查网络连接
- 确认在 Sepolia 网络

### 问题2: 显示"加载信用数据失败"
**原因**: 合约调用出错
**解决方案**:
1. 检查网络是否为 Sepolia
2. 检查合约地址是否正确
3. 查看控制台错误信息

### 问题3: 显示"暂无信用数据"
**原因**: 合约中确实没有该地址的信用评分数据
**解决方案**:
1. 确认这是正常情况（新地址没有数据）
2. 需要通过 Oracle 或 Agent 服务初始化数据
3. 或者先铸造 SBT

### 问题4: 刷新按钮无效
**原因**: 可能是缓存问题
**解决方案**:
1. 硬刷新页面 (Ctrl+F5)
2. 清除浏览器缓存
3. 重新连接钱包

## 🔧 手动测试方法

### 方法1: 浏览器控制台测试
在浏览器控制台运行：
```javascript
// 测试您的地址
testContract('0xB95E8e0960Ad789D560AD6e65D574180Af9361b8')
```

### 方法2: Etherscan 验证
1. 访问: https://sepolia.etherscan.io/address/0x7CE2fbEfDF5dc7E43477816bfD2e89d5b26Cff38
2. 点击 "Contract" → "Read Contract"
3. 找到 `getUserCreditInfo` 函数
4. 输入您的地址: `0xB95E8e0960Ad789D560AD6e65D574180Af9361b8`
5. 点击 "Query" 查看结果

## 📊 预期结果

### 如果合约中有数据：
```
返回结果应该是数组格式:
[0] = {keystone: xxx, ability: xxx, wealth: xxx, health: xxx, behavior: xxx, lastUpdate: xxx, updateCount: xxx}
[1] = totalScore (数字)
[2] = rarity (0-3)
[3] = tokenId (数字)
```

### 如果合约中没有数据：
```
返回结果可能是全零值或空值
```

## 🚀 下一步行动

根据测试结果：

1. **如果测试成功且有数据**: 问题可能在前端显示逻辑
2. **如果测试成功但无数据**: 需要初始化信用数据
3. **如果测试失败**: 检查网络和合约配置

## 💡 快速修复建议

1. **强制刷新**: Ctrl+F5 硬刷新页面
2. **重新连接**: 断开并重新连接钱包
3. **切换网络**: 断开钱包，重新连接到 Sepolia
4. **清除缓存**: 清除浏览器缓存和本地存储

## 📞 获取帮助

如果以上方法都无法解决问题，请提供：
1. 浏览器控制台的完整日志
2. 调试信息的截图
3. 合约测试的结果
4. 您的钱包地址和网络信息

这样我可以提供更精确的解决方案。
